#!/usr/bin/env bash

pdf_file=${1}

# create tmp dir
tmp_dir=$(mktemp -d)

# 1. extract odd and even pages of pdf generated by readable (odd: ja, even: en)
pdftk A=${1} cat Aodd output ${tmp_dir}/odd.pdf
pdftk A=${1} cat Aeven output ${tmp_dir}/even.pdf

# 2. compress odd pages
gs -sDEVICE=pdfwrite \
   -dCompatibilityLevel=1.4 \
   -dPDFSETTINGS=/screen \
   -dNOPAUSE -dQUIET -dBATCH \
   -sOutputFile=${tmp_dir}/odd.min.pdf ${tmp_dir}/odd.pdf

# 3. concatenate odd and even pages
out_path=${pdf_file%.*}.min.pdf
pdftk A=${tmp_dir}/odd.min.pdf B=${tmp_dir}/even.pdf shuffle A B output ${out_path}

# 4. remove tmp dir
rm -rf ${tmp_dir}

# size of original pdf
orig_size=$(du -h ${pdf_file} | cut -f1)
# size of compressed pdf
min_size=$(du -h ${out_path} | cut -f1)

echo "Done: ${out_path} (${orig_size} -> ${min_size})"
